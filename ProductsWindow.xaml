<Page x:Class="WpfApp3.ProductsWindow"
     xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
     xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
     xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
     xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
     xmlns:local="clr-namespace:WpfApp3"
     mc:Ignorable="d" 
     d:DesignHeight="600" d:DesignWidth="1000"
     Title="ProductsWindow">

   <Page.Resources>
       <local:DiscountGreaterThan15Converter x:Key="DiscountGreaterThan15Converter"/>
       <local:HasDiscountConverter x:Key="HasDiscountConverter"/>
       <local:DiscountToFinalPriceMultiConverter x:Key="DiscountToFinalPriceMultiConverter"/>
       <local:ImagePathConverter x:Key="ImagePathConverter"/> 
   </Page.Resources>

   <DockPanel Margin="10">
       <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,8" >
  
           <TextBox x:Name="SearchBox" Width="280" Margin="0,0,10,0" 
                    TextChanged="SearchBox_TextChanged"/>

           <ComboBox x:Name="SupplierFilter" Width="200" Margin="0,0,10,0" SelectionChanged="SupplierFilter_SelectionChanged"/>

           <Button Content="Сортировка по количеству ↑/↓" Click="ToggleSort_Click" Width="200" Margin="0,0,10,0"/>

           <Button Content="Загрузить фото" Click="UploadImage_Click" Width="120" Margin="0,0,10,0"/>

           <Button Content="Добавить" Click="Add_Click" Width="100" Margin="0,0,10,0"/>
           <Button Content="Редактировать" Click="Edit_Click" Width="110" Margin="0,0,10,0"/>
           <Button Content="Удалить" Click="Delete_Click" Width="100"/>
       </StackPanel>

       <ListView x:Name="ProductsListView" Margin="0,8,0,0" SelectionMode="Single">
           <ListView.ItemContainerStyle>
               <Style TargetType="ListViewItem">
                   <Setter Property="Padding" Value="6"/>
                   <Setter Property="Margin" Value="2"/>
                   <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                   <Setter Property="Background" Value="Transparent"/>
                   <Style.Triggers>
                       <DataTrigger Binding="{Binding Quantity}" Value="0">
                           <Setter Property="Background" Value="LightBlue"/>
                       </DataTrigger>

                       <DataTrigger Binding="{Binding Discount, Converter={StaticResource DiscountGreaterThan15Converter}}" Value="True">
                           <Setter Property="Background" Value="#2E8B57"/>
                       </DataTrigger>
                   </Style.Triggers>
               </Style>
           </ListView.ItemContainerStyle>

           <ListView.View>
               <GridView>
                   <GridViewColumn Header="Фото" Width="140">
                       <GridViewColumn.CellTemplate>
                           <DataTemplate>
                               <Border Width="130" Height="90" Background="#FFF0F0F0" CornerRadius="4" Padding="2">
                                   <Image Source="{Binding ImagePath, Converter={StaticResource ImagePathConverter}}" Stretch="Uniform" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                               </Border>
                           </DataTemplate>
                       </GridViewColumn.CellTemplate>
                   </GridViewColumn>

                   <GridViewColumn Header="Название" DisplayMemberBinding="{Binding Name}" Width="200"/>

                   <GridViewColumn Header="Категория" DisplayMemberBinding="{Binding Category}" Width="130"/>

                   <GridViewColumn Header="Поставщик" DisplayMemberBinding="{Binding Manufacturer}" Width="150"/>

                   <GridViewColumn Header="Цена" Width="200">
                       <GridViewColumn.CellTemplate>
                           <DataTemplate>
                               <StackPanel Orientation="Vertical">
                                   <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                       <TextBlock Text="{Binding Price, StringFormat=C}" FontSize="14" Margin="0,0,8,0">
                                           <TextBlock.Style>
                                               <Style TargetType="TextBlock">
                                                   <Style.Triggers>
                                                       <DataTrigger Binding="{Binding Discount, Converter={StaticResource HasDiscountConverter}}" Value="True">
                                                           <Setter Property="TextDecorations" Value="Strikethrough"/>
                                                           <Setter Property="Foreground" Value="Red"/>
                                                       </DataTrigger>
                                                   </Style.Triggers>
                                               </Style>
                                           </TextBlock.Style>
                                       </TextBlock>

                                       <TextBlock FontWeight="Bold" VerticalAlignment="Center">
                                           <TextBlock.Text>
                                               <MultiBinding Converter="{StaticResource DiscountToFinalPriceMultiConverter}" StringFormat="- {0:C}">
                                                   <Binding Path="Price"/>
                                                   <Binding Path="Discount"/>
                                               </MultiBinding>
                                           </TextBlock.Text>
                                       </TextBlock>
                                   </StackPanel>

                                   <TextBlock Text="{Binding Discount, StringFormat='Скидка: {0}%'}" FontSize="12">
                                       <TextBlock.Style>
                                           <Style TargetType="TextBlock">
                                               <Setter Property="Foreground" Value="Gray"/>

                                               <Style.Triggers>
                                                   <DataTrigger Binding="{Binding Discount, Converter={StaticResource DiscountGreaterThan15Converter}}" Value="True">
                                                       <Setter Property="Foreground" Value="#FF8C00"/>
                                                   </DataTrigger>
                                               </Style.Triggers>
                                           </Style>
                                       </TextBlock.Style>
                                   </TextBlock>

                               </StackPanel>
                           </DataTemplate>
                       </GridViewColumn.CellTemplate>
                   </GridViewColumn>

                   <GridViewColumn Header="Наличие" Width="100">
                       <GridViewColumn.CellTemplate>
                           <DataTemplate>
                               <TextBlock Text="{Binding Quantity}" HorizontalAlignment="Center"/>
                           </DataTemplate>
                       </GridViewColumn.CellTemplate>
                   </GridViewColumn>

               </GridView>
           </ListView.View>
       </ListView>
   </DockPanel>
</Page>
